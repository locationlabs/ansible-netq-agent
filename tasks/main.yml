---
# NetQ only supported on Cumulus 3.3+
- name: Check Cumulus version
  assert:
    that:
      - "ansible_lsb.release | version_compare('3.3', '>=')"

- name: Add netq repo
  apt_repository:
    repo: deb http://apps3.cumulusnetworks.com/repos/deb CumulusLinux-3 netq-latest
    state: present

# The netq package installs addtional config to rsyslog
- name: Install netq agent
  apt:
    name: cumulus-netq
    update_cache: yes
  notify: restart rsyslog

- name: Configure netq agent
  copy:
    content: "{{ netq_backend_config|to_nice_yaml }}"
    dest: /etc/netq/config.d/backend_server.yml
  notify: restart netq
